valuesFilePath: build-values.yml

{{- $runtimeName := .Values.runtime.name }}
{{- $buildCommand := ternary "mvn install -DskipTests" "npm run build" (eq $runtimeName "java") }}

resources:
  - name: source_code
    type: GitRepo
    configuration:
      path: {{ .Values.sourceCode.repoPath }}
      gitProvider: {{ .Values.sourceCode.authIntegration }}

pipelines:
  - name: {{ $runtimeName }}_build
    configuration:
      jfrogCliVersion: 2
      runtime:
        type: image
        image:
          auto:
            language: {{ $runtimeName }}
            versions:
              {{- range $version := .Values.runtime.versions }}
              - {{ $version }}
              {{- end }}
    steps:
      - name: build
        type: Bash
        configuration:
          inputResources:
            - name: source_code
        execution:
          onExecute:
            - pushd ${res_source_code_resourcePath}
            - {{ $buildCommand }}